<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="profile-title">Professional Profile - JobScooter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c5282;
            --secondary-color: #3182ce;
            --accent-color: #38a169;
            --text-color: #2d3748;
            --light-bg: #f7fafc;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-color);
            background: var(--light-bg);
        }

        .profile-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }

        .profile-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .profile-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .skill-tag {
            background: var(--accent-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            margin-right: 0.5rem;
            margin-bottom: 0.25rem;
            display: inline-block;
        }

        .traffic-light {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
            margin-left: 0.5rem;
        }

        .traffic-light.green {
            background: var(--accent-color);
        }

        .traffic-light.yellow {
            background: #ed8936;
        }

        .traffic-light.red {
            background: #e53e3e;
        }

        .blur-content {
            filter: blur(5px);
            pointer-events: none;
            user-select: none;
        }

        .upgrade-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            z-index: 10;
        }

        .upgrade-card {
            background: white;
            border: 2px solid var(--accent-color);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .restricted-section {
            position: relative;
        }

        .verification-badge {
            background: var(--accent-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }

        .contact-button {
            background: var(--accent-color);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
            border-radius: 50px;
            color: white;
            transition: all 0.3s ease;
        }

        .contact-button:hover {
            background: #2f855a;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(56, 161, 105, 0.3);
            color: white;
        }

        .video-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }

        .video-preview {
            width: 100%;
            border-radius: 10px;
        }

        .language-badges {
            margin: 0.5rem 0;
        }

        .language-badge {
            background: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            margin-right: 0.5rem;
            display: inline-block;
        }

        .navbar {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .public-indicator {
            background: #28a745;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.875rem;
            margin-bottom: 1rem;
            display: inline-block;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/" style="color: var(--primary-color);">
                <i class="fas fa-rocket me-2"></i>JobScooter
            </a>
            <div class="d-flex align-items-center">
                <a href="/" class="btn btn-outline-primary me-2">
                    <i class="fas fa-search me-2"></i>Find Talent
                </a>
                <a href="/login" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt me-2"></i>Login
                </a>
            </div>
        </div>
    </nav>

    <!-- Profile Header -->
    <div class="profile-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-3 text-center">
                    <img id="profile-photo" src="https://via.placeholder.com/150" alt="Profile Photo" class="profile-photo">
                </div>
                <div class="col-md-9">
                    <div class="d-flex align-items-center mb-2">
                        <h1 id="profile-name" class="mb-0">Loading Profile...</h1>
                        <div class="traffic-light green" id="profile-status">
                            <i class="fas fa-check"></i>
                        </div>
                        <span class="verification-badge">Verified Profile</span>
                    </div>
                    <p class="lead mb-3" id="profile-title-text">Professional Title</p>
                    <div class="language-badges" id="languages-container">
                        <!-- Languages will be populated here -->
                    </div>
                    <div class="mt-3" id="public-actions">
                        <button class="contact-button me-2" onclick="contactCandidate()" id="contact-btn">
                            <i class="fas fa-envelope me-2"></i>Contact Candidate
                        </button>
                        <button class="btn btn-outline-light" onclick="shareProfile()">
                            <i class="fas fa-share me-2"></i>Share Profile
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Access Level Indicator -->
    <div class="container">
        <div class="public-indicator" id="access-indicator">
            <i class="fas fa-eye me-2"></i>Public View - Limited Information
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <!-- Left Column -->
            <div class="col-md-8">
                <!-- About Section -->
                <div class="profile-card">
                    <h4><i class="fas fa-user me-2"></i>About</h4>
                    <div id="about-content">
                        <p id="profile-summary">Professional summary and background information will appear here...</p>
                    </div>
                </div>

                <!-- Skills Section -->
                <div class="profile-card">
                    <h4><i class="fas fa-cogs me-2"></i>Skills & Expertise</h4>
                    <div id="skills-container">
                        <!-- Skills will be populated here -->
                    </div>
                </div>

                <!-- Education & Certifications (Restricted) -->
                <div class="profile-card restricted-section" id="education-section">
                    <h4><i class="fas fa-graduation-cap me-2"></i>Education & Certifications</h4>
                    <div class="blur-content" id="education-content">
                        <div class="mb-3">
                            <strong>Bachelor of Science in Computer Science</strong><br>
                            <small class="text-muted">University of Technology | 2020</small>
                        </div>
                        <div class="mb-3">
                            <strong>AWS Certified Solutions Architect</strong><br>
                            <small class="text-muted">Amazon Web Services | 2022</small>
                        </div>
                        <div class="mb-3">
                            <strong>Project Management Professional (PMP)</strong><br>
                            <small class="text-muted">Project Management Institute | 2021</small>
                        </div>
                    </div>
                    <div class="upgrade-overlay" id="education-overlay">
                        <div class="upgrade-card">
                            <i class="fas fa-crown fa-2x text-warning mb-3"></i>
                            <h5>Subscriber Access Required</h5>
                            <p class="mb-3">Upgrade to see detailed education and certification information</p>
                            <button class="btn btn-warning" onclick="upgradeAccess()">
                                <i class="fas fa-star me-2"></i>Upgrade Access
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Video Introduction (Restricted) -->
                <div class="profile-card restricted-section" id="video-section">
                    <h4><i class="fas fa-video me-2"></i>Video Introduction</h4>
                    <div class="video-container blur-content">
                        <video class="video-preview" controls poster="https://via.placeholder.com/400x300?text=Video+Introduction">
                            <source src="#" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    <div class="upgrade-overlay">
                        <div class="upgrade-card">
                            <i class="fas fa-play-circle fa-2x text-primary mb-3"></i>
                            <h5>Watch Video Introduction</h5>
                            <p class="mb-3">See this candidate's personal introduction and hear about their experience</p>
                            <button class="btn btn-primary" onclick="upgradeAccess()">
                                <i class="fas fa-unlock me-2"></i>Unlock Video
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-md-4">
                <!-- Contact Information (Restricted) -->
                <div class="profile-card restricted-section" id="contact-section">
                    <h4><i class="fas fa-address-card me-2"></i>Contact Information</h4>
                    <div class="blur-content" id="contact-content">
                        <p><i class="fas fa-envelope me-2"></i>candidate@email.com</p>
                        <p><i class="fas fa-phone me-2"></i>+27 XX XXX XXXX</p>
                        <p><i class="fas fa-map-marker-alt me-2"></i>Cape Town, South Africa</p>
                    </div>
                    <div class="upgrade-overlay">
                        <div class="upgrade-card">
                            <i class="fas fa-phone fa-2x text-success mb-3"></i>
                            <h5>Contact Details</h5>
                            <p class="mb-3">Get direct access to contact this candidate</p>
                            <button class="btn btn-success" onclick="upgradeAccess()">
                                <i class="fas fa-envelope me-2"></i>Get Contact Info
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Profile Stats -->
                <div class="profile-card">
                    <h4><i class="fas fa-chart-line me-2"></i>Profile Stats</h4>
                    <div class="row text-center">
                        <div class="col-6">
                            <h3 class="text-primary" id="profile-views">0</h3>
                            <small>Profile Views</small>
                        </div>
                        <div class="col-6">
                            <h3 class="text-success" id="verification-score">95%</h3>
                            <small>Verified</small>
                        </div>
                    </div>
                </div>

                <!-- Available Languages -->
                <div class="profile-card">
                    <h4><i class="fas fa-globe me-2"></i>Languages</h4>
                    <div id="detailed-languages">
                        <!-- Detailed language info will be populated here -->
                    </div>
                </div>

                <!-- Subscription CTA -->
                <div class="profile-card" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;" id="subscription-cta">
                    <div class="text-center">
                        <i class="fas fa-crown fa-3x mb-3"></i>
                        <h5>Unlock Full Profile</h5>
                        <p class="mb-3">Get access to contact details, full education history, and video introduction</p>
                        <button class="btn btn-light btn-lg" onclick="upgradeAccess()">
                            <i class="fas fa-star me-2"></i>Subscribe Now
                        </button>
                        <p class="mt-2 mb-0"><small>Starting from $9.99/month</small></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div class="modal fade" id="contactModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Contact Candidate</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="contact-form">
                        <div class="mb-3">
                            <label for="employer-name" class="form-label">Your Name</label>
                            <input type="text" class="form-control" id="employer-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="employer-email" class="form-label">Your Email</label>
                            <input type="email" class="form-control" id="employer-email" required>
                        </div>
                        <div class="mb-3">
                            <label for="company-name" class="form-label">Company Name</label>
                            <input type="text" class="form-control" id="company-name">
                        </div>
                        <div class="mb-3">
                            <label for="message" class="form-label">Message</label>
                            <textarea class="form-control" id="message" rows="4" placeholder="Tell the candidate about the opportunity..."></textarea>
                        </div>
                    </div>
                    <div id="upgrade-prompt" class="text-center" style="display: none;">
                        <i class="fas fa-lock fa-3x text-warning mb-3"></i>
                        <h5>Subscriber Access Required</h5>
                        <p>To contact candidates directly, please upgrade to a subscriber account.</p>
                        <button class="btn btn-warning" onclick="upgradeAccess()">
                            <i class="fas fa-crown me-2"></i>Upgrade Now
                        </button>
                    </div>
                </div>
                <div class="modal-footer" id="contact-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="sendMessage()">
                        <i class="fas fa-paper-plane me-2"></i>Send Message
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let profileSlug = '';
        let isSubscriber = false;
        let profileData = {};

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Get profile slug from URL
            const pathParts = window.location.pathname.split('/');
            profileSlug = pathParts[pathParts.length - 1] || 'demo-user';
            
            loadProfile();
            checkSubscriptionStatus();
        });

        async function loadProfile() {
            try {
                const authToken = localStorage.getItem('jobscooter_auth_token');
                
                // If user is authenticated, try to load their own profile first
                if (authToken) {
                    try {
                        const myProfileResponse = await fetch('/api/public/my-profile', {
                            headers: {
                                'Authorization': `Bearer ${authToken}`
                            }
                        });
                        
                        if (myProfileResponse.ok) {
                            const myProfileData = await myProfileResponse.json();
                            if (myProfileData.success) {
                                profileData = myProfileData.profile;
                                displayLiveProfile(myProfileData.profile);
                                return; // Successfully loaded own profile
                            }
                        }
                    } catch (myProfileError) {
                        console.log('Could not load own profile, trying public profile');
                    }
                }
                
                // Fallback to public profile API
                const response = await fetch(`/api/public/profile/${profileSlug}`);
                const data = await response.json();

                if (response.ok && data.success) {
                    profileData = data.profile;
                    displayProfile(data.profile, data.isSubscriber || false);
                } else {
                    // Show error or demo data
                    displayDemoProfile();
                }
            } catch (error) {
                console.error('Error loading profile:', error);
                displayDemoProfile();
            }
        }

        function displayLiveProfile(profile) {
            isSubscriber = true; // User viewing their own profile has full access
            
            // Update page title with real name
            document.title = `${profile.fullName || profile.firstName + ' ' + profile.surname} - JobScooter Profile`;
            document.getElementById('profile-title').textContent = `${profile.fullName || profile.firstName + ' ' + profile.surname} - JobScooter`;

            // Basic info with real data
            document.getElementById('profile-name').textContent = profile.fullName || `${profile.firstName} ${profile.surname}`;
            document.getElementById('profile-title-text').textContent = profile.country || 'Professional';
            document.getElementById('profile-summary').textContent = 
                `Verified professional with ${profile.certificateCount || 0} certificates and ${profile.languageCount || 0} language(s). Profile completion: ${profile.completionPercentage || 0}%.`;

            // Real profile photo
            if (profile.profilePictureUrl) {
                document.getElementById('profile-photo').src = profile.profilePictureUrl;
                document.getElementById('profile-photo').alt = profile.fullName || 'Profile Photo';
            }

            // Real languages
            const languageNames = (profile.languages || []).map(lang => 
                typeof lang === 'string' ? lang : lang.language
            );
            displayLanguages(languageNames.length > 0 ? languageNames : ['English']);

            // Generate skills from certificates and languages
            const skills = [];
            if (profile.certificates) {
                profile.certificates.forEach(cert => {
                    if (cert.field_of_study) skills.push(cert.field_of_study);
                    if (cert.certificate_type) skills.push(cert.certificate_type);
                });
            }
            languageNames.forEach(lang => skills.push(lang));
            displaySkills([...new Set(skills)].slice(0, 10)); // Remove duplicates, limit to 10

            // Real stats
            document.getElementById('profile-views').textContent = '0'; // Could be updated with real view count
            document.getElementById('verification-score').textContent = `${profile.trafficLightScore || 0}%`;

            // Update traffic light status
            const statusElement = document.getElementById('profile-status');
            const status = profile.trafficLightStatus || 'red';
            statusElement.className = `traffic-light ${status}`;
            statusElement.innerHTML = status === 'green' ? '<i class="fas fa-check"></i>' : 
                                    status === 'yellow' ? '<i class="fas fa-exclamation"></i>' : 
                                    '<i class="fas fa-times"></i>';

            // Show own profile indicator
            const indicator = document.getElementById('access-indicator');
            indicator.style.background = '#007bff';
            indicator.innerHTML = '<i class="fas fa-user me-2"></i>Your Profile - All Information Visible';

            // Hide subscription CTA for own profile
            document.getElementById('subscription-cta').style.display = 'none';
            
            // Show real contact info
            showLiveContactInfo(profile);
            
            // Show real education data
            showLiveEducation(profile);
            
            // Update action buttons for own profile
            updateOwnProfileActions();
        }
        
        function showLiveContactInfo(profile) {
            // Remove blur and overlays
            document.querySelectorAll('.blur-content').forEach(el => {
                el.classList.remove('blur-content');
            });
            document.querySelectorAll('.upgrade-overlay').forEach(el => {
                el.style.display = 'none';
            });
            
            // Show real contact info
            document.getElementById('contact-content').innerHTML = `
                <p><i class="fas fa-envelope me-2"></i>${profile.email}</p>
                <p><i class="fas fa-phone me-2"></i>${profile.phone || 'Not provided'}</p>
                <p><i class="fas fa-map-marker-alt me-2"></i>${profile.country || 'Not specified'}</p>
                <p><i class="fas fa-id-card me-2"></i>Member since ${new Date(profile.memberSince).toLocaleDateString()}</p>
            `;
        }
        
        function showLiveEducation(profile) {
            if (profile.certificates && profile.certificates.length > 0) {
                document.getElementById('education-content').innerHTML = profile.certificates.map(cert => `
                    <div class="mb-3">
                        <strong>${cert.certificate_type || 'Certificate'} ${cert.field_of_study ? `in ${cert.field_of_study}` : ''}</strong>
                        ${cert.is_verified ? '<span class="verification-badge ms-2">âœ“ Verified</span>' : ''}<br>
                        <small class="text-muted">${cert.institution_name || 'Institution'} | ${cert.date_issued ? new Date(cert.date_issued).getFullYear() : 'Date not specified'}</small>
                    </div>
                `).join('');
            } else {
                document.getElementById('education-content').innerHTML = '<p class="text-muted">No certificates uploaded yet. <a href="/page3.html">Add certificates</a></p>';
            }
        }
        
        function updateOwnProfileActions() {
            const actionsDiv = document.getElementById('public-actions');
            actionsDiv.innerHTML = `
                <a href="/profile-edit.html" class="contact-button me-2">
                    <i class="fas fa-edit me-2"></i>Edit Profile
                </a>
                <button class="btn btn-outline-light" onclick="shareProfile()">
                    <i class="fas fa-share me-2"></i>Share My Profile
                </button>
            `;
        }

        function displayProfile(profile, subscriberAccess) {
            isSubscriber = subscriberAccess;

            // Update page title
            document.title = `${profile.name || 'Professional'} - JobScooter Profile`;
            document.getElementById('profile-title').textContent = `${profile.name || 'Professional'} - JobScooter`;

            // Basic info (always visible)
            document.getElementById('profile-name').textContent = profile.name || 'Professional Name';
            document.getElementById('profile-title-text').textContent = profile.title || 'Professional Title';
            document.getElementById('profile-summary').textContent = profile.summary || 'Professional with expertise in various fields, committed to excellence and innovation.';

            // Profile photo
            if (profile.profilePhoto) {
                document.getElementById('profile-photo').src = profile.profilePhoto;
            }

            // Languages
            displayLanguages(profile.languages || ['English']);

            // Skills (basic skills always visible)
            displaySkills(profile.skills || ['Communication', 'Problem Solving', 'Team Work']);

            // Stats
            document.getElementById('profile-views').textContent = profile.views || Math.floor(Math.random() * 100) + 50;
            document.getElementById('verification-score').textContent = profile.verificationScore || '95%';

            // Update access level indicator
            updateAccessIndicator(subscriberAccess);

            // Show/hide restricted content based on subscription
            if (subscriberAccess) {
                showSubscriberContent(profile);
            } else {
                showPublicContent();
            }
        }

        function displayDemoProfile() {
            const demoProfile = {
                name: 'Demo Professional',
                title: 'Software Developer & Project Manager',
                summary: 'Experienced software developer with 5+ years in full-stack development and team leadership. Passionate about creating innovative solutions and mentoring junior developers.',
                languages: ['English', 'German'],
                skills: ['JavaScript', 'React', 'Node.js', 'Python', 'Project Management', 'Agile'],
                views: 127,
                verificationScore: '98%'
            };

            displayProfile(demoProfile, false);
        }

        function displayLanguages(languages) {
            const container = document.getElementById('languages-container');
            const detailedContainer = document.getElementById('detailed-languages');
            
            container.innerHTML = '';
            detailedContainer.innerHTML = '';

            languages.forEach(lang => {
                // Header languages
                const badge = document.createElement('span');
                badge.className = 'language-badge';
                badge.textContent = lang;
                container.appendChild(badge);

                // Detailed languages
                const detail = document.createElement('p');
                detail.innerHTML = `<i class="fas fa-language me-2"></i>${lang}`;
                if (lang === 'German') {
                    detail.innerHTML += ' <span class="verification-badge">Certified</span>';
                }
                detailedContainer.appendChild(detail);
            });
        }

        function displaySkills(skills) {
            const container = document.getElementById('skills-container');
            container.innerHTML = '';

            skills.forEach(skill => {
                const tag = document.createElement('span');
                tag.className = 'skill-tag';
                tag.textContent = skill;
                container.appendChild(tag);
            });
        }

        function updateAccessIndicator(subscriberAccess) {
            const indicator = document.getElementById('access-indicator');
            if (subscriberAccess) {
                indicator.className = 'public-indicator';
                indicator.style.background = '#28a745';
                indicator.innerHTML = '<i class="fas fa-crown me-2"></i>Subscriber Access - Full Profile';
            } else {
                indicator.innerHTML = '<i class="fas fa-eye me-2"></i>Public View - Limited Information';
            }
        }

        function showSubscriberContent(profile) {
            // Remove blur and overlays
            document.querySelectorAll('.blur-content').forEach(el => {
                el.classList.remove('blur-content');
            });
            document.querySelectorAll('.upgrade-overlay').forEach(el => {
                el.style.display = 'none';
            });

            // Hide subscription CTA
            document.getElementById('subscription-cta').style.display = 'none';

            // Populate restricted content
            if (profile.education) {
                document.getElementById('education-content').innerHTML = profile.education.map(edu => `
                    <div class="mb-3">
                        <strong>${edu.qualification}</strong><br>
                        <small class="text-muted">${edu.institution} | ${edu.year}</small>
                    </div>
                `).join('');
            }

            if (profile.contactInfo) {
                document.getElementById('contact-content').innerHTML = `
                    <p><i class="fas fa-envelope me-2"></i>${profile.contactInfo.email}</p>
                    <p><i class="fas fa-phone me-2"></i>${profile.contactInfo.phone}</p>
                    <p><i class="fas fa-map-marker-alt me-2"></i>${profile.contactInfo.location}</p>
                `;
            }

            // Update contact button behavior
            document.getElementById('contact-btn').onclick = () => {
                document.getElementById('contact-form').style.display = 'block';
                document.getElementById('upgrade-prompt').style.display = 'none';
                document.getElementById('contact-footer').style.display = 'block';
                const modal = new bootstrap.Modal(document.getElementById('contactModal'));
                modal.show();
            };
        }

        function showPublicContent() {
            // Contact button shows upgrade prompt
            document.getElementById('contact-btn').onclick = () => {
                document.getElementById('contact-form').style.display = 'none';
                document.getElementById('upgrade-prompt').style.display = 'block';
                document.getElementById('contact-footer').style.display = 'none';
                const modal = new bootstrap.Modal(document.getElementById('contactModal'));
                modal.show();
            };
        }

        function checkSubscriptionStatus() {
            // Check if user is logged in and has subscription
            const authToken = localStorage.getItem('jobscooter_auth_token');
            if (authToken) {
                // Could check subscription status here
                // For now, assume public access unless verified subscriber
            }
        }

        function contactCandidate() {
            if (!isSubscriber) {
                // Show upgrade prompt
                document.getElementById('contact-form').style.display = 'none';
                document.getElementById('upgrade-prompt').style.display = 'block';
                document.getElementById('contact-footer').style.display = 'none';
            } else {
                // Show contact form
                document.getElementById('contact-form').style.display = 'block';
                document.getElementById('upgrade-prompt').style.display = 'none';
                document.getElementById('contact-footer').style.display = 'block';
            }

            const modal = new bootstrap.Modal(document.getElementById('contactModal'));
            modal.show();
        }

        async function sendMessage() {
            const employerName = document.getElementById('employer-name').value;
            const employerEmail = document.getElementById('employer-email').value;
            const companyName = document.getElementById('company-name').value;
            const message = document.getElementById('message').value;

            if (!employerName || !employerEmail || !message) {
                alert('Please fill in all required fields');
                return;
            }

            try {
                const response = await fetch(`/api/public/contact/${profileSlug}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        employerName,
                        employerEmail,
                        companyName,
                        message
                    })
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    alert('Your message has been sent successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('contactModal')).hide();
                    
                    // Clear form
                    document.getElementById('employer-name').value = '';
                    document.getElementById('employer-email').value = '';
                    document.getElementById('company-name').value = '';
                    document.getElementById('message').value = '';
                } else {
                    throw new Error(result.message || 'Failed to send message');
                }
            } catch (error) {
                console.error('Error sending message:', error);
                alert('Failed to send message. Please try again.');
            }
        }

        function shareProfile() {
            const profileUrl = window.location.href;
            
            if (navigator.share) {
                navigator.share({
                    title: `${profileData.name || 'Professional'} - JobScooter Profile`,
                    text: `Check out this professional profile on JobScooter`,
                    url: profileUrl
                });
            } else {
                // Fallback to copy to clipboard
                navigator.clipboard.writeText(profileUrl).then(() => {
                    alert('Profile link copied to clipboard!');
                });
            }
        }

        function upgradeAccess() {
            // Redirect to subscription page or show upgrade modal
            alert('Subscription feature coming soon! Contact support@jobscooter.co.za for premium access.');
        }

        // Track profile view
        fetch(`/api/public/profile/${profileSlug}/view`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                timestamp: new Date().toISOString(),
                referrer: document.referrer
            })
        }).catch(() => {
            // Ignore tracking errors
        });
    </script>
</body>
</html>